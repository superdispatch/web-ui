name: PR Workflow
on:
  pull_request:
    branches: [master]
    paths:
      - "packages/**"
      - ".github/workflows/pr.yml"
jobs:
  checks:
    runs-on: ubuntu-latest
    steps:
      - uses: superdispatch/actions/prepare-node-repo@v2
        with:
          cache-key: cache-v6-
          pnpm-version: 10
          fetch-depth: 2
      - run: git fetch origin master --depth=1
      - run: npx nx affected --target=lint --base=origin/master
      - run: npx nx affected --target=test --base=origin/master
  build-storybook:
    runs-on: ubuntu-latest
    needs:
      - checks
    steps:
      - uses: superdispatch/actions/prepare-node-repo@v2
        with:
          cache-key: cache-v6-
          pnpm-version: 10
      - run: npx nx build-storybook @superdispatch/ui-next --verbose
      - uses: actions/upload-artifact@v4
        with:
          name: build-storybook
          path: storybook-static
